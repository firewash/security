# 总纲 #

## 背景 ##
安全，是一个重要的话题。而前端安全，又是安全中的一个重要场景，前端漏洞危害有时不亚于后端漏洞。

前端安全问题可能会随着浏览器或W3C规范的发展，不断产生新的场景，该文档旨在介绍已有的常见安全问题，及应对策略。

*之前《前端安全基础(一)》，已整理到分章节中。*

## 简述 ##

前端常见的漏洞有XSS、CSRF、CORS等。

 - XSS:Cross Site Scripting，跨站脚本攻击
 - CSRF:Cross-site request forgery，跨站请求伪造
 - CORS:Cross-origin resource sharing，严格来说这一种是浏览器跨域机制，并不是漏洞。放在这里可以引起关注，可以忽略。

广义的，还有客户端（浏览器）上的安全漏洞也会危及到用户环境或数据的安全。比如：
 - 扩展可以任意申请私有API，而无名单限制。
 - 客户端面向网页开发API，而无名单限制。


## 目录 ##

1. [XSS](xss.md "xss.md")

2. [CSRF](csrf.md "csrf.md")

## 其他 ##

### Access-Control-Allow-Origin 设置为*时的安全风险 ###

需要设置具体的域名，而不是*，否则存在一定的风险，即其他的域可以使用该资源。当然，如果是纯静态的资源（CSS，JS，Image等）关系不是很大。

### 不要信任referer ###
不要信任https头的信息，因为这些信息是可以伪造的。


### URL名单鉴权 ###
比如Java后台不要这样：srcUrl.contains(excludePath)，建议这样：建议使用.endsWith。

如果JS对host进行鉴别，使用 location.host.includes()，而不要使用location.href.includes()，否则很可能被绕过。

### 敏感信息泄露 ###
重要的信息（比如密码，银行卡号）不要直接写入到JS、Flash等代码里，也不要写到cookie或localstorage等缓存里。

### iframe攻击 ###

iframe攻击是把被攻击页面以iframe嵌入黑客网页，再通过遮挡或者其它方式诱导用户操作到被攻击页面。

 - 正常页面不要加P3P头？？
 - 使用Content-Security-Policy的frame-src
 - 使用脚本
  
		if(window !== window.top) {
	    	window.top.location.href = window.location.href;
		}

### URL重定向/跳转漏洞 ###

应用程序常常内部根据不同的逻辑将用户引向到不同的页面。

如果处理不好，会将用户浏览器从可信的站点导向到不可信的站点，同时如果跳转的时候带有敏感数据一样可能将敏感数据泄漏给不可信的第三方。从而产生欺诈行为。

对于URL跳转的实现一般会有几种实现方式：

- META标签内跳转
- JavaScript跳转
- HTTP Response Header跳转

欺诈除了包括泄露信息，还可能会制造一些比如“中奖信息”这样的跳转网页。

### 网站防嵌入 ###
网站要防止被iFrame嵌入，可以增加类似下面的判断代码：`top!===window && alert("禁止嵌入")`
 

## 其他 ##

可以持续关注社会上和公司内的平台，从而获取业界最新的安全漏洞知识。

> 乌云知识库：[http://drops.wooyun.org/](http://drops.wooyun.org/)

> 公司的安全中心：[http://stc.alibaba-inc.com/bug/bug_list.htm](http://stc.alibaba-inc.com/bug/bug_list.htm)
> > 阿里公司有个服务器中间件 [midway-security 中途岛](http://gitlab.alibaba-inc.com/midway-gallery/midway-security/tree/master#midway "http://gitlab.alibaba-inc.com/midway-gallery/midway-security/tree/master#midway") ，封装了一些常规文本处理方法：

> > - escapeHtml 过滤指定的html中的字符, 防xss漏洞
> > - jsEncode 对输入的String进行JavaScript 转义。 对中文进行unicode转义, 单引号, 双引号转义
> > - cssEncode 对css中的属性，进行16进制编码。
> >	- escapeJson 不破坏JSON结构的escape函数, 只对json结构中name和vaule做escapeHtml处理
> > - escapeJsonForJsVar 可以理解就是jsEncode+escapeJson
> > - parseUrl 判断url是否符合集团规范, 不符合则返回""
> > - parseRedirectUrl 判断跳转url是否符合集团规范, 不符合则返回""
> > - richText 过滤富文本
> > 
> > 这些对处理文本的方法的背后所隐藏到处理方式，适用于其他语言。

> 安全中心帮助文档：[http://stc.taobao.net/swiki/index](http://stc.taobao.net/swiki/index)

> 手淘安全规则：[http://gitlab.alibaba-inc.com/mtb/doc/wikis/security](http://gitlab.alibaba-inc.com/mtb/doc/wikis/security)

