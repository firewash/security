# 总纲 #

前端常见的漏洞就是XSS、CSRF、CORS等。
 - XSS:
 - CSRF:
 - CORS:Cross-origin resource sharing，严格来说这是一种使用场景，不是漏洞

还有各种客户端（浏览器）上的安全漏洞也会危及到网站的安全。


> 乌云知识库：[http://drops.wooyun.org/](http://drops.wooyun.org/)

> 公司的安全中心：[http://stc.alibaba-inc.com/bug/bug_list.htm](http://stc.alibaba-inc.com/bug/bug_list.htm)

> 安全中心帮助文档：[http://stc.taobao.net/swiki/index](http://stc.taobao.net/swiki/index)

> 手淘安全规则：[http://gitlab.alibaba-inc.com/mtb/doc/wikis/security](http://gitlab.alibaba-inc.com/mtb/doc/wikis/security)

## XSS ##

### XSS漏洞通用信条 ###
永远不要信任用户的输入，以及URL上的内容。
不要将这些内容“直接”以HTML（包括HTML，Image src ，a href ，window location等）或JS或CSS等的方式写在页面上

需要经过escape或encodeURI。

这里的用户的输入指哪些内容？
 - window.location
 - document.referer
 - cookie
 - form 和input内容
 - 其他用户提交后保存在数据库的内容


### Content-Security-Policy ###

推荐使用Content-Security-Policy在足够新版本的浏览器中限制XSS？？？

## CSRF ##
跨站请求伪造。两个特征：跨站+请求伪造。

尤其涉及增删改数据（Restful API中常包含这样的关键字`add|delete|modify|edit|update|create|insert|upload|import|confirm`），比较危险。

怎么治？ Token。

### 表单提交时的CSRF ###
如果一个表单，有可能用来数据增删改，则需要防范CSRF。实际涉及增删改的场景都要防CSRF，如果不涉及数据增删改，可以忽略CSRF风险。

怎么防范呢：
1. 请确认使用POST请求，而非GET请求。
2. 增加token参数，并在服务端校验token。

### 链接中的CSRF ###
如果一个`<a>`或一个`location.href`跳转，如果用来数据增删改，要方式CSRF。

### Ajax中的CSRF ###
Ajax发出的post请求，如果涉及到增删改，也要防止CSRF。
防止方法同样是增加token。

## 其他 ##

### Access-Control-Allow-Origin 设置为*时的安全风险 ###

需要设置具体的域名，而不是*，否则存在一定的风险，即其他的域可以使用该资源。当然，如果是纯静态的资源（CSS，JS，Image等）关系不是很大。

### 不要信任referre ###
不要信任https头的信息，因为这些信息是可以伪造的。


### URL名单鉴权 ###
比如Java后台不要这样：srcUrl.contains(excludePath)，建议这样：建议使用.endsWith。

如果JS对host进行鉴别，使用 location.host.includes()，而不要使用location.href.includes()，否则很可能被绕过。

### 敏感信息泄露 ###
重要的信息（比如密码，银行卡号）不要直接写入到JS、Flash等代码里，也不要写到cookie或localstorage等缓存里。

### iframe攻击 ###

iframe攻击是把被攻击页面以iframe嵌入黑客网页，再通过遮挡或者其它方式诱导用户操作到被攻击页面。

 - 正常页面不要加P3P头？？
 - 使用Content-Security-Policy的frame-src
 - 使用脚本
  
		if(window !== window.top) {
	    	window.top.location.href = window.location.href;
		}

### URL重定向/跳转漏洞 ###

应用程序常常内部根据不同的逻辑将用户引向到不同的页面。

如果处理不好，会将用户浏览器从可信的站点导向到不可信的站点，同时如果跳转的时候带有敏感数据一样可能将敏感数据泄漏给不可信的第三方。从而产生欺诈行为。

对于URL跳转的实现一般会有几种实现方式：

- META标签内跳转
- javascript跳转
- header头跳转

欺诈除了包括泄露信息，还可能会制造一些比如“中奖信息”这样的跳转网页。


## 常见处理方式 ##
阿里公司有个中间件 [midway-security 中途岛](http://gitlab.alibaba-inc.com/midway-gallery/midway-security/tree/master#midway "http://gitlab.alibaba-inc.com/midway-gallery/midway-security/tree/master#midway") ，提供了一些常规方法：

- escapeHtml 过滤指定的html中的字符, 防xss漏洞
- jsEncode 对输入的String进行JavaScript 转义。 对中文进行unicode转义, 单引号, 双引号转义
- cssEncode 对css中的属性，进行16进制编码。
- escapeJson 不破坏JSON结构的escape函数, 只对json结构中name和vaule做escapeHtml处理
- escapeJsonForJsVar 可以理解就是jsEncode+escapeJson
- parseUrl 判断url是否符合集团规范, 不符合则返回""
- parseRedirectUrl 判断跳转url是否符合集团规范, 不符合则返回""
- richText 过滤富文本

这些对文本的处理方式，适用于其他语言。


